name: project-tests

on:
  push:
    branches:
      - '**'
    tags:
      - '**'

jobs:
    tests:
      runs-on: ubuntu-latest
          
      steps:
        - name: Checkout
          uses: actions/checkout@v3
          
        - name: Setup Node
          uses: actions/setup-node@v3
          with:
            node-version: 16.18
          
        - name: Install Dependencies
          run: npm ci
        - name: Run tests
          run: npm test
        - name: Run lint
          run: npx eslint .
        - name: Test & publish code coverage
            # Publish code coverage on Code Climate
            # https://github.com/paambaati/codeclimate-action
          uses: paambaati/codeclimate-action@v5.0.0
            # Add Code Climate secret key
          env:
            CC_TEST_REPORTER_ID: ${{ secrets.CC_TEST_REPORTER_ID }}
          with:
            coverageCommand: make test-coverage
            debug: true